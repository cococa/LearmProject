<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>
    <title>Title</title>
    <style type="text/css">
        img {
            max-width: 100%;
            height: 120px;
        }

        html, body, * {
            padding: 0px;
            margin: 0px;
        }

        ul {
            list-style-type: none;
        }

        li {
            display: flex;
            padding: 20px;
        }

        li.active {
            background-color: #f7f4f4;
        }

        img {
            float: left;
        }

        p {
            clear: both;
        }

        .decoration {
            text-decoration: line-through;
        }

        h5.price {
            color: #FF0036;

        }

        .li-right {
            margin: 0px 0px 0px 10px;
        }

        div > h5 {
            margin: 6px 0px 0px 0px;
        }

        button {
            margin: 5px 15px 5px 5px;
        }

        .btn {
            float: left;
        }

    </style>
</head>
<body>
<div id="item">
    <ul>
        <li v-for="(it,index) in items" v-cloak :class="{'active': index %2 == 0 } ">

            <img v-bind:src="it.pict_url"/>

            <div class="li-right">
                <h5 class="title">{{index}}--{{ it.title }}</h5>
                <h5 class="decoration">价格:{{ it.reserve_price }}</h5>
                <h5 class="price">促销价:{{ it.zk_final_price }}</h5>
                <h5> 销量:{{ it.sales }}</h5>

                <div class="btn">
                    <button @click="add(it)">addto-sj</button>
                    <button @click="show(it)">open-tb</button>
                    <button @click="del(it)">delete-tb</button>
                </div>
            </div>

        </li>
    </ul>

    <button @click="nextPage()"> next page</button>
</div>
</body>
<script src="https://unpkg.com/vue"></script>
<script type="text/javascript" src="//g.alicdn.com/mtb/lib-applink/0.3.7/??callApp.js,linksdk.js"></script>
<!--http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.iDrdBy&treeId=129&articleId=105908&docType=1-->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">

    window.BC_SDK = BCSDK_AppLink.init({
        appkey: '23781332', //必填，输入百川应用的appkey
        backURL: 'tbopen23781332://', //必填，默认为空字符串，applink的tips的回跳url， 设置能在手机淘宝里面调回你自己应用的url，格式为`tbopen${appkey}`。
        openApp: true, //非必填，默认为true，非必填，是否唤起客户端，设置false，只会做H5跳转。
        linkKey: 'TB', //非必填，默认为TB, 唤起手淘(TB)/天猫(TM)。
//        isNeedDownload: false, //非必填，默认为false, 没有app的情况下跳转目标h5页面还是下载页, 默认跳转目标h5页面。
        isDefaultRedirect: false, //选填, 没有唤起app的情况下是否默认跳转, 默认true。
//        params:{}, //非必填，带给applink协议的扩展参数,用户自定义参数也传在这里, 如scm、pvid、pid、subpid、e、unionId等业务参数会放到这里。
//        trackParams:{}, //非必填，ybhpss的映射对象，传入这里的参数会被拼为ybhpss字符串带到协议上。
//        timeout: 1000 // 非必填，默认跳转(目标h5页/下载页)的延时时长。
    });

    var example1 = new Vue({
            el: '#item',
            data: {
                index: 0,
                items: [],
                itemDebug: [{
                    "id": 6285,
                    "item_url": "http://item.taobao.com/item.htm?id\u003d524540166255",
                    "nick": "天猫超市",
                    "num_iid": "524540166255",
                    "pict_url": "http://img1.tbcdn.cn/tfscom/i2/725677994/TB1xOkCawMPMeJjy1XbXXcwxVXa_!!2-item_pic.png",
                    "provcity": "上海",
                    "reserve_price": "15.00",
                    "seller_id": "725677994",
                    "small_img": "http://img1.tbcdn.cn/tfscom/i2/725677994/TB1xOkCawMPMeJjy1XbXXcwxVXa_!!2-item_pic.png@@http://img2.tbcdn.cn/tfscom/i1/725677994/TB2UvSbkVXXXXblXpXXXXXXXXXX_!!725677994.jpg@@http://img4.tbcdn.cn/tfscom/i1/725677994/TB2mn9Ya9iJ.eBjSszfXXa4bVXa_!!725677994.jpg@@http://img1.tbcdn.cn/tfscom/i3/725677994/TB2N4t9ipXXXXbHXpXXXXXXXXXX_!!725677994.jpg@",
                    "title": "TC蔓越莓曲奇饼干手提兔子铁礼盒手工休闲零食品儿童女友送礼80g",
                    "user_type": "1",
                    "volume": "205542",
                    "zk_final_price": "205542",
                    "sales": 257073,
                    "sales_update_time": "Nov 20, 2017 6:00:56 PM",
                    "create_time": "Nov 20, 2017 6:00:56 PM",
                    "status": 0
                }, {
                    "id": 6868,
                    "item_url": "http://item.taobao.com/item.htm?id\u003d520291956767",
                    "nick": "三只松鼠旗舰店",
                    "num_iid": "520291956767",
                    "pict_url": "http://img2.tbcdn.cn/tfscom/i2/880734502/TB1nV8ad2DH8KJjy1XcXXcpdXXa_!!0-item_pic.jpg",
                    "provcity": "安徽 芜湖",
                    "reserve_price": "55.00",
                    "seller_id": "880734502",
                    "small_img": "http://img2.tbcdn.cn/tfscom/i2/880734502/TB2ZQEdam4mpuFjSZFOXXaUqpXa_!!880734502.jpg@@http://img2.tbcdn.cn/tfscom/i4/880734502/TB2cGtAXMwjyKJjSsppXXaxUpXa_!!880734502.jpg@@http://img3.tbcdn.cn/tfscom/i2/880734502/TB2X.sQdpXXXXXQXXXXXXXXXXXX_!!880734502.jpg@@http://img3.tbcdn.cn/tfscom/i1/880734502/TB2AExdlMJlpuFjSspjXXcT.pXa_!!880734502.jpg@",
                    "title": "聚【三只松鼠_夹心麻薯210gx3】传统糕点点心美食早餐零食组合",
                    "user_type": "1",
                    "volume": "22298",
                    "zk_final_price": "22298",
                    "sales": 185973,
                    "sales_update_time": "Nov 20, 2017 6:08:34 PM",
                    "create_time": "Nov 20, 2017 6:08:34 PM",
                    "status": 0
                }, {
                    "id": 6669,
                    "item_url": "http://item.taobao.com/item.htm?id\u003d44800690064",
                    "nick": "天猫超市",
                    "num_iid": "44800690064",
                    "pict_url": "http://img2.tbcdn.cn/tfscom/i3/725677994/TB19EQua5ERMeJjy0FcXXc7opXa_!!2-item_pic.png",
                    "provcity": "上海",
                    "reserve_price": "18.90",
                    "seller_id": "725677994",
                    "small_img": "http://img2.tbcdn.cn/tfscom/i3/725677994/TB19EQua5ERMeJjy0FcXXc7opXa_!!2-item_pic.png@@http://img3.tbcdn.cn/tfscom/i2/725677994/TB2S00Rcp_.F1JjSZFjXXahnXXa_!!725677994.jpg@@http://img3.tbcdn.cn/tfscom/i1/725677994/TB2AqyXaYH8F1JjSspfXXarnXXa_!!725677994.jpg@@http://img2.tbcdn.cn/tfscom/i4/725677994/TB2QUp.cyb_F1JjSZFzXXc6KXXa_!!725677994.jpg@",
                    "title": "百草味 蔓越莓曲奇100g 休闲零食小吃 饼干点心",
                    "user_type": "1",
                    "volume": "140814",
                    "zk_final_price": "140814",
                    "sales": 180619,
                    "sales_update_time": "Nov 20, 2017 6:06:03 PM",
                    "create_time": "Nov 20, 2017 6:06:03 PM",
                    "status": 0
                }]
            },
            methods: {
                getData: function () {
                    var vm = this;
                    axios.get('/product/taobao/getItems?status=0&size=30&page=' + vm.index)
                        .then(function (response) {
                            vm.index++;
                            vm.items = response.data;
                        })
                },
                nextPage: function () {
                    var vm = this;
                    axios.get('/product/taobao/getItems?status=0&size=30&page=' + vm.index)
                        .then(function (response) {
                            vm.index++;
                            vm.items = vm.items.concat(response.data);
                        })
                },

                del: function (item) {
                    var vm = this;
                    axios.get('/product/taobao/updateItemStatus?id=' + item.num_iid + '&status=delete')
                        .then(function (response) {
                            if (response.data.code == 0) {
                                // 获取元素的位置
                                var index = getIndex(vm.items, item);
                                if (index >= 0) {
                                    // 删除元素
                                    vm.items.remove(index);
                                }
                            } else {
                                alert(response.data.msg);
                            }
                        })
                }
                ,
                show: function (item) {
                    window.BC_SDK.goDetail({
                        itemId: item.num_iid,
                        params: {}
                    });

                },
                add: function (item) {
                    // 做 天猫超市 百草味 周黑鸭 三只松鼠  天猫生鲜 等的提示
                    if ((shopFilter(item.title) || shopFilter(item.nick)) && !item.flag) {
                        alert("这个店铺可能是大流量店铺，提醒！！！");
                        item.flag = true;
                        return;
                    }
                    var vm = this;
                    // 先入shiji，在修改taobao的status
                    axios.post('/product/shiji/additem_tb', {item: JSON.stringify(item)})
                        .then(function (response) {
                            if (response.data.code == 0) {
                                axios.get('/product/taobao/updateItemStatus?id=' + item.num_iid + '&status=inserted')
                                    .then(function (response) {
                                        if (response.data.code == 0) {
                                            // 获取元素的位置
                                            var index = getIndex(vm.items, item);
                                            if (index >= 0) {
                                                // 删除元素
                                                vm.items.remove(index);
                                            }
                                        } else {
                                            alert(response.data.msg);
                                        }
                                    })
                            } else {
                                alert(response.data.msg);
                            }
                        })
                }
            }
        })
    ;
    example1.getData();


    function getIndex(array, temp) {
        for (var i = 0; i < array.length; i++) {
            if (array[i].num_iid == temp.num_iid) {
                return i;
            }
        }
        return -1;
    }


    Array.prototype.remove = function (dx) {
        if (isNaN(dx) || dx > this.length) {
            return false;
        }
        this.splice(dx, 1);
    }

    var shopArray = ["百草味", "周黑鸭", "三只松鼠", "良品铺子", "天猫生鲜", "天猫超市", "天猫"];

    function shopFilter(str) {
        for (var i = 0; i < shopArray.length; i++) {
            if (str.indexOf(shopArray[i]) > -1) {
                return true;
            }
        }
        return false;
    }


</script>

</html>

<!--id: 6285,-->
<!--item_url: "http://item.taobao.com/item.htm?id=524540166255",-->
<!--nick: "天猫超市",-->
<!--num_iid: "524540166255",-->
<!--pict_url: "http://img1.tbcdn.cn/tfscom/i2/725677994/TB1xOkCawMPMeJjy1XbXXcwxVXa_!!2-item_pic.png",-->
<!--provcity: "上海",-->
<!--reserve_price: "15.00",-->
<!--seller_id: "725677994",-->
<!--small_img: "http://img1.tbcdn.cn/tfscom/i2/725677994/TB1xOkCawMPMeJjy1XbXXcwxVXa_!!2-item_pic.png@@http://img2.tbcdn.cn/tfscom/i1/725677994/TB2UvSbkVXXXXblXpXXXXXXXXXX_!!725677994.jpg@@http://img4.tbcdn.cn/tfscom/i1/725677994/TB2mn9Ya9iJ.eBjSszfXXa4bVXa_!!725677994.jpg@@http://img1.tbcdn.cn/tfscom/i3/725677994/TB2N4t9ipXXXXbHXpXXXXXXXXXX_!!725677994.jpg@",-->
<!--title: "TC蔓越莓曲奇饼干手提兔子铁礼盒手工休闲零食品儿童女友送礼80g",-->
<!--user_type: "1",-->
<!--volume: "205542",-->
<!--zk_final_price: "205542",-->
<!--sales: 257073,-->
<!--sales_update_time: "Nov 20, 2017 6:00:56 PM",-->
<!--create_time: "Nov 20, 2017 6:00:56 PM",-->
<!--status: 0-->